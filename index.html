<!Doctype html>
<html>
<head>
<title>PhysicsJS</title>
<script src="physicsjs-full.js"></script>
</head>
<body>
  <div id="myDiv"><textarea id="myScript" style="width: 300px; height:200px;" value=""></textarea><button id="updateBtn" onclick="changeScript();userFunction();">Update</button></div>
  <script>
    var userFunction=function(){};
    var changeScript=function(){
      var theInput = document.getElementById("myScript");
      userFunction=function(){
        eval(theInput.value.replace(/world/g,"worlda"));
      };
    };
    var worlda;
Physics(function(world){
worlda=world;
  var viewWidth = 500;
  var viewHeight = 600;

  var renderer = Physics.renderer('canvas',{
  width: 600,
  height: 600,
  });

  // add the renderer
  world.add( renderer );
  // render on each step
  world.on('step', function(){
    world.render();
  });

  // bounds of the window
  var viewportBounds = Physics.aabb(0, 0, viewWidth, viewHeight);

  // constrain objects to these bounds
  world.add(Physics.behavior('edge-collision-detection', {
      aabb: viewportBounds,
      restitution: 0.66,
      cof: 0.99
  }));

  // add a circle
  world.add(
      Physics.body('circle', {
        x: 50, // x-coordinate
        y: 30, // y-coordinate
        vx: 0.2, // velocity in x-direction
        vy: 0.01, // velocity in y-direction
        radius: 20
      })
  );
  world.add( Physics.body('convex-polygon', {
    x: 250,
    y: 50,
    vx: 0.05,
    vertices: [
        {x: 0, y: 80},
        {x: 60, y: 40},
        {x: 60, y: -40},
        {x: 0, y: -80}
    ]
}) );
  world.add( Physics.body('convex-polygon', {
    x: 350,
    y: 50,
    vx: 0.05,
    vertices: [
        {x: 0, y: 80},
        {x: 60, y: 40},
        {x: 60, y: -40},
        {x: 0, y: -80}
    ]
}) );
  try{
    userFunction();
  }catch(err){
    console.warn(err);
  }
  
    var attractor = Physics.behavior('attractor', {
        order: 0,
        strength: .002
    });
    world.on({
        'interact:poke': function( pos ){
            world.wakeUpAll();
            attractor.position( pos );
            world.add( attractor );
        }
        ,'interact:move': function( pos ){
            attractor.position( pos );
        }
        ,'interact:release': function(){
            world.wakeUpAll();
            world.remove( attractor );
        }
    });
  // ensure objects bounce when edge collision is detected
  world.add( Physics.behavior('body-impulse-response') );
  world.add( Physics.behavior('body-collision-detection') );
world.add( Physics.behavior('sweep-prune') );
  // add some gravity
  world.add( Physics.behavior('constant-acceleration') );

  // subscribe to ticker to advance the simulation
  Physics.util.ticker.on(function( time, dt ){
      document.getElementsByClassName('pjs-layer-main')[0].width="500";
      document.getElementsByClassName('pjs-layer-main')[0].height="600";
      world.step( time );
  });

  // start the ticker
  Physics.util.ticker.start();

});  
</script>
</body>
</html>
